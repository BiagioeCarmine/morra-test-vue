{"version":3,"sources":["webpack:///./src/views/Play.vue","webpack:///./src/views/Play.vue?7980"],"names":["over","scoreUser","scoreOtherPlayer","waiting","secondiRimanenti","hand","type","value","prediction","name","data","q","query","match","remainingTime","nextRoundTime","token","id","weAreUser1","active","created","localStorage","getItem","console","log","window","location","href","backend","verifyUser","res","this","getMatch","userid1","userid2","alert","setInterval","calculateRemainingSeconds","setTimeout","beforeRouteLeave","methods","Math","floor","Date","getTime","now","confirmed","start_time","msToNextRound","setMove","getMove","cur_points1","cur_points2","next_round_start","render"],"mappings":"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","file":"js/chunk-2d0ddbee.f00cb651.js","sourcesContent":["<template>\n  <div v-if=\"over\">\n    Partita finita\n    <div v-if=\"scoreUser == 12\">\n      <h1>Hai vinto, complimenti, dona del danaro a carmine@carminezacc.com su PayPal e vincerai anche altre partite</h1>\n    </div>\n    <div v-if=\"scoreOtherPlayer == 12\">\n      <h1>Hai perso, dona del danaro a carmine@carminezacc.com su PayPal e vedi che vincerai almeno una partita prima o poi</h1>\n    </div>\n  </div>\n  <div v-else-if=\"waiting\">\n    In attesa...\n  </div>\n  <div v-else>\n    <h1>Gioca la partita</h1>\n    <h2>{{ secondiRimanenti }} secondi rimanenti per scegliere la mossa</h2>\n    <h2> {{ scoreUser }}-{{ scoreOtherPlayer }}</h2>\n    <h2>Mano, scelta {{ hand }}</h2>\n    <input type=\"radio\" value=1 v-model=\"hand\" />1<br />\n    <input type=\"radio\" value=2 v-model=\"hand\" />2<br />\n    <input type=\"radio\" value=3 v-model=\"hand\" />3<br />\n    <input type=\"radio\" value=4 v-model=\"hand\" />4<br />\n    <input type=\"radio\" value=5 v-model=\"hand\" />5<br />\n    <h2>Previsione, scelta {{ prediction }}</h2>\n    <input type=\"radio\" value=2 v-model=\"prediction\" />2<br />\n    <input type=\"radio\" value=3 v-model=\"prediction\" />3<br />\n    <input type=\"radio\" value=4 v-model=\"prediction\" />4<br />\n    <input type=\"radio\" value=5 v-model=\"prediction\" />5<br />\n    <input type=\"radio\" value=6 v-model=\"prediction\" />6<br />\n    <input type=\"radio\" value=7 v-model=\"prediction\" />7<br />\n    <input type=\"radio\" value=8 v-model=\"prediction\" />8<br />\n    <input type=\"radio\" value=9 v-model=\"prediction\" />9<br />\n    <input type=\"radio\" value=10 v-model=\"prediction\" />10<br />\n  </div>\n\n</template>\n<script>\nimport backend from \"../backend\"\nimport {useRoute} from 'vue-router';\n\nexport default {\n  name: 'Play',\n  data: () => {\n      return {\n        q: useRoute().query.match,\n        scoreUser: 0,\n        scoreOtherPlayer: 0,\n        waiting: true,\n        hand: 1,\n        match: {},\n        prediction: 2,\n        remainingTime: 5,\n        nextRoundTime: null,\n        secondiRimanenti: 0,\n        token: \"\",\n        id: 0,\n        weAreUser1: false,\n        active: true,\n        over: false\n      }\n  },\n  created: async function() {\n    let token = localStorage.getItem(\"token\");\n    if(token == null) {\n      console.log(\"andiamo al login per token mancante\");\n      window.location.href = \"/#/login\";\n      return;\n    }\n\n    try {\n      let res = await backend.verifyUser(token);\n      this.id = res.data.id;\n    } catch(e) {\n      console.log(\"andiamo al login per token non valido\");\n      window.location.href = \"/#/login\";\n      return;\n    }\n    this.token = token;\n    await this.getMatch();\n    if(this.match.userid1 == this.id) {\n      this.weAreUser1 = true;\n    } else if (this.match.userid2 != this.id) {\n      alert(\"con questa partita non c'entri niente\");\n      window.location.href = \"/\";\n    }\n\n    setInterval(this.calculateRemainingSeconds, 500)\n    setTimeout(() => {\n      if(this.waiting)\n        window.location.href = \"/\";\n    }, 15000)\n  },\n  beforeRouteLeave: function() {\n    this.active = false;\n  },\n  methods: {\n      async calculateRemainingSeconds() {\n        this.secondiRimanenti = Math.floor((new Date(this.nextRoundTime).getTime()-Date.now())/1000)\n      },\n      async getMatch() {\n        this.match = await backend.getMatch(this.q);\n        if(this.waiting && !this.match.confirmed) {\n          setTimeout(this.getMatch, 800) // aspettiamo che la partita sia confermata\n        }\n        if(this.match.confirmed) {\n          this.waiting = false;\n          this.nextRoundTime = this.match.start_time;\n          let msToNextRound = new Date(this.match.start_time).getTime()-Date.now()-2000;\n          setTimeout(this.setMove, msToNextRound);\n          this.remainingTime = Math.floor(msToNextRound/1000);\n        }\n      },\n      async setMove() {\n        if(!this.active) return;\n        try {\n            let res = await backend.setMove(this.hand, this.prediction, this.match.id, this.token);\n            setTimeout(this.getMove, 2000);\n        } catch(e){ alert(`Si è verificato l'errore\\n${e}`);}\n      },\n      async getMove() {\n        if(!this.active) return;\n        try {\n            let res = await backend.getMove(this.match.id);\n            console.log(res.data);\n            if(this.weAreUser1) {\n              this.scoreUser = res.data.cur_points1;\n              this.scoreOtherPlayer = res.data.cur_points2;\n            } else {\n              this.scoreUser = res.data.cur_points2;\n              this.scoreOtherPlayer = res.data.cur_points1;\n            }\n            if(res.data.next_round_start == \"over\") {\n              this.over = true;\n              return;\n            }\n            let msToNextRound = new Date(res.data.next_round_start).getTime()-Date.now()-2000;\n            this.nextRoundTime = res.data.next_round_start;\n            setTimeout(this.setMove, msToNextRound);\n        } catch(e){ alert(`Si è verificato l'errore\\n${e}`);}\n      }\n  }\n}\n</script>\n","import { render } from \"./Play.vue?vue&type=template&id=0f96ea0e\"\nimport script from \"./Play.vue?vue&type=script&lang=js\"\nexport * from \"./Play.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}